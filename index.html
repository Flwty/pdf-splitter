<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>📄 在线 PDF 切分工具</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- pdf-lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-2xl transition transform hover:scale-[1.01]">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">📄 在线 PDF 切分工具</h1>

    <!-- 文件上传 -->
    <div class="mb-5">
      <label class="block text-gray-700 font-medium mb-2">选择 PDF 文件：</label>
      <input type="file" id="pdfFile" accept="application/pdf"
        class="w-full border rounded-lg px-3 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
    </div>

    <!-- 页码输入 -->
    <div class="mb-5">
      <label class="block text-gray-700 font-medium mb-2">输入页码区间（如 1-3,5,7-10）：</label>
      <input type="text" id="ranges" placeholder="1-3,5,7-10"
        class="w-full border rounded-lg px-3 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
    </div>

    <!-- 按钮 -->
    <div class="flex justify-center">
      <button onclick="splitPdf()"
        class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-lg transition hover:bg-blue-600 hover:shadow-xl active:scale-95">
        🚀 开始切分
      </button>
    </div>

    <!-- 输出结果 -->
    <h3 class="text-xl font-semibold text-gray-700 mt-8 mb-3">输出结果：</h3>
    <div id="output" class="space-y-3"></div>
  </div>

  <script>
  async function splitPdf() {
    const fileInput = document.getElementById("pdfFile");
    const rangesInput = document.getElementById("ranges").value.trim();
    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";

    if (!fileInput.files.length) {
      alert("请先上传 PDF 文件！");
      return;
    }
    if (!rangesInput) {
      alert("请输入页码区间！");
      return;
    }

    const file = fileInput.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

    const totalPages = pdfDoc.getPageCount();
    const ranges = parseRanges(rangesInput, totalPages);

    for (let i = 0; i < ranges.length; i++) {
      const [start, end] = ranges[i];
      const newPdf = await PDFLib.PDFDocument.create();
      const copiedPages = await newPdf.copyPages(
        pdfDoc,
        Array.from({length: end-start+1}, (_,k)=> start-1+k)
      );
      copiedPages.forEach(p => newPdf.addPage(p));

      const pdfBytes = await newPdf.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);

      // 动态生成下载链接
      const link = document.createElement("a");
      link.href = url;
      link.download = `split_${i+1}_${start}-${end}.pdf`;
      link.textContent = `⬇️ 下载 split_${i+1}_${start}-${end}.pdf`;
      link.className = "block px-4 py-2 bg-green-500 text-white rounded-lg shadow transition hover:bg-green-600 hover:shadow-md animate-fadeIn";

      outputDiv.appendChild(link);
    }
  }

  function parseRanges(input, maxPages) {
    const result = [];
    const parts = input.split(",");
    for (const part of parts) {
      if (part.includes("-")) {
        const [s, e] = part.split("-").map(x=>parseInt(x.trim()));
        if (s && e && s<=e && s<=maxPages) {
          result.push([s, Math.min(e, maxPages)]);
        }
      } else {
        const num = parseInt(part.trim());
        if (num && num<=maxPages) {
          result.push([num, num]);
        }
      }
    }
    return result;
  }

  // 添加淡入动画
  const style = document.createElement("style");
  style.innerHTML = `
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.6s ease forwards;
    }
  `;
  document.head.appendChild(style);
  </script>
</body>
</html>

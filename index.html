<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“„ åœ¨çº¿ PDF åˆ‡åˆ†å·¥å…·</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- pdf-lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-2xl transition transform hover:scale-[1.01]">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">ğŸ“„ åœ¨çº¿ PDF åˆ‡åˆ†å·¥å…·</h1>

    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <div class="mb-5">
      <label class="block text-gray-700 font-medium mb-2">é€‰æ‹© PDF æ–‡ä»¶ï¼š</label>
      <input type="file" id="pdfFile" accept="application/pdf"
        class="w-full border rounded-lg px-3 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
    </div>

    <!-- é¡µç è¾“å…¥ -->
    <div class="mb-5">
      <label class="block text-gray-700 font-medium mb-2">è¾“å…¥é¡µç åŒºé—´ï¼ˆå¦‚ 1-3,5,7-10ï¼‰ï¼š</label>
      <input type="text" id="ranges" placeholder="1-3,5,7-10"
        class="w-full border rounded-lg px-3 py-2 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
    </div>

    <!-- æŒ‰é’® -->
    <div class="flex justify-center">
      <button onclick="splitPdf()"
        class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-lg transition hover:bg-blue-600 hover:shadow-xl active:scale-95">
        ğŸš€ å¼€å§‹åˆ‡åˆ†
      </button>
    </div>

    <!-- è¾“å‡ºç»“æœ -->
    <h3 class="text-xl font-semibold text-gray-700 mt-8 mb-3">è¾“å‡ºç»“æœï¼š</h3>
    <div id="output" class="space-y-3"></div>
  </div>

  <script>
  async function splitPdf() {
    const fileInput = document.getElementById("pdfFile");
    const rangesInput = document.getElementById("ranges").value.trim();
    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";

    if (!fileInput.files.length) {
      alert("è¯·å…ˆä¸Šä¼  PDF æ–‡ä»¶ï¼");
      return;
    }
    if (!rangesInput) {
      alert("è¯·è¾“å…¥é¡µç åŒºé—´ï¼");
      return;
    }

    const file = fileInput.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

    const totalPages = pdfDoc.getPageCount();
    const ranges = parseRanges(rangesInput, totalPages);

    for (let i = 0; i < ranges.length; i++) {
      const [start, end] = ranges[i];
      const newPdf = await PDFLib.PDFDocument.create();
      const copiedPages = await newPdf.copyPages(
        pdfDoc,
        Array.from({length: end-start+1}, (_,k)=> start-1+k)
      );
      copiedPages.forEach(p => newPdf.addPage(p));

      const pdfBytes = await newPdf.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);

      // åŠ¨æ€ç”Ÿæˆä¸‹è½½é“¾æ¥
      const link = document.createElement("a");
      link.href = url;
      link.download = `split_${i+1}_${start}-${end}.pdf`;
      link.textContent = `â¬‡ï¸ ä¸‹è½½ split_${i+1}_${start}-${end}.pdf`;
      link.className = "block px-4 py-2 bg-green-500 text-white rounded-lg shadow transition hover:bg-green-600 hover:shadow-md animate-fadeIn";

      outputDiv.appendChild(link);
    }
  }

  function parseRanges(input, maxPages) {
    const result = [];
    const parts = input.split(",");
    for (const part of parts) {
      if (part.includes("-")) {
        const [s, e] = part.split("-").map(x=>parseInt(x.trim()));
        if (s && e && s<=e && s<=maxPages) {
          result.push([s, Math.min(e, maxPages)]);
        }
      } else {
        const num = parseInt(part.trim());
        if (num && num<=maxPages) {
          result.push([num, num]);
        }
      }
    }
    return result;
  }

  // æ·»åŠ æ·¡å…¥åŠ¨ç”»
  const style = document.createElement("style");
  style.innerHTML = `
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.6s ease forwards;
    }
  `;
  document.head.appendChild(style);
  </script>
</body>
</html>
